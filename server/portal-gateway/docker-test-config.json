{
  "http": {
    "routers": [
      {
        "name": "root",
        "middlewares": ["rootRedirectregex"],
        "rule": "Path('/')",
        "service": "dashboard-frontend"
      },
      {
        "name": "auth",
        "rule": "PathPrefix('/auth')",
        "service": "portal-iam"
      },

      {
        "name": "dashboard-frontend",
        "middlewares": [
          "dashboardRedirectRegex",
          "dashboardAuthBearer",
          "dashboardReplacePath"
        ],
        "rule": "PathPrefix('/dashboard')",
        "service": "dashboard-frontend"
      },
      {
        "name": "dashboard-service",
        "middlewares": ["dashboardAuthBearer"],
        "rule": "PathPrefix('/dashboard/service')",
        "service": "dashboard-service"
      },
      {
        "name": "dashboard-login",
        "middlewares": ["dashboardOauth2", "dashboardLoginRedirectRegex"],
        "rule": "Path('/dashboard/login')",
        "priority": 100,
        "service": "dashboard-frontend"
      },

      {
        "name": "navigation-frontend",
        "middlewares": [
          "navigationRedirectRegex",
          "navigationAuthBearer",
          "navigationReplacePath"
        ],
        "rule": "PathPrefix('/navigation')",
        "service": "navigation-frontend"
      },
      {
        "name": "navigation-service",
        "middlewares": ["navigationAuthBearer"],
        "rule": "PathPrefix('/navigation/service')",
        "service": "navigation-service"
      },

      {
        "name": "organisation-service",
        "middlewares": [
          "organisationRedirectRegex",
          "organisationOauth2",
          "organisationAuthBearer",
          "organisationReplacePath"
        ],
        "rule": "PathPrefix('/organisation')",
        "service": "organisation-proxy-public"
      },

      {
        "name": "document-service",
        "middlewares": [
          "documentRedirectRegex",
          "documentOauth2",
          "documentAuthBearer",
          "documentReplacePath"
        ],
        "rule": "PathPrefix('/document')",
        "service": "document-proxy-public"
      }
    ],

    "middlewares": [
      {
        "name": "rootRedirectregex",
        "type": "redirectRegex",
        "options": { "regex": "^/$", "replacement": "/dashboard/" }
      },

      {
        "name": "dashboardAuthBearer",
        "type": "authorizationBearer",
        "options": { "sessionScope": "dashboardScope" }
      },
      {
        "name": "dashboardLoginRedirectRegex",
        "type": "redirectRegex",
        "options": {
          "regex": "^(/dashboard/login)$",
          "replacement": "/dashboard/"
        }
      },
      {
        "name": "dashboardOauth2",
        "type": "oauth2",
        "options": {
          "clientId": "Dashboard",
          "clientSecret": "Dashboard!",
          "discoveryUrl": "http://portal-iam:8080/auth/realms/portal",
          "sessionScope": "dashboardScope"
        }
      },
      {
        "name": "dashboardRedirectRegex",
        "type": "redirectRegex",
        "options": { "regex": "^(/dashboard)$", "replacement": "$1/" }
      },
      {
        "name": "dashboardReplacePath",
        "type": "replacePathRegex",
        "options": { "regex": "/dashboard/(.*)", "replacement": "/$1" }
      },

      {
        "name": "navigationAuthBearer",
        "type": "authorizationBearer",
        "options": { "sessionScope": "id" }
      },
      {
        "name": "navigationRedirectRegex",
        "type": "redirectRegex",
        "options": { "regex": "^(/navigation)$", "replacement": "$1/" }
      },
      {
        "name": "navigationReplacePath",
        "type": "replacePathRegex",
        "options": { "regex": "/navigation/(.*)", "replacement": "/$1" }
      },

      {
        "name": "organisationAuthBearer",
        "type": "authorizationBearer",
        "options": { "sessionScope": "organisationScope" }
      },
      {
        "name": "organisationOauth2",
        "type": "oauth2",
        "options": {
          "clientId": "Organisation",
          "clientSecret": "Organisation!",
          "discoveryUrl": "http://portal-iam:8080/auth/realms/portal",
          "sessionScope": "organisationScope"
        }
      },
      {
        "name": "organisationRedirectRegex",
        "type": "redirectRegex",
        "options": { "regex": "^(/organisation)$", "replacement": "$1/" }
      },
      {
        "name": "organisationReplacePath",
        "type": "replacePathRegex",
        "options": { "regex": "/organisation/(.*)", "replacement": "/$1" }
      },

      {
        "name": "documentAuthBearer",
        "type": "authorizationBearer",
        "options": { "sessionScope": "documentScope" }
      },
      {
        "name": "documentOauth2",
        "type": "oauth2",
        "options": {
          "clientId": "Document",
          "clientSecret": "Document!",
          "discoveryUrl": "http://portal-iam:8080/auth/realms/portal",
          "sessionScope": "documentScope"
        }
      },
      {
        "name": "documentRedirectRegex",
        "type": "redirectRegex",
        "options": { "regex": "^(/document)$", "replacement": "$1/" }
      },
      {
        "name": "documentReplacePath",
        "type": "replacePathRegex",
        "options": { "regex": "/document/(.*)", "replacement": "/$1" }
      }
    ],

    "services": [
      {
        "name": "portal-iam",
        "servers": [{ "host": "portal-iam", "port": 8080 }]
      },

      {
        "name": "dashboard-frontend",
        "servers": [{ "host": "dashboard-frontend", "port": 20025 }]
      },
      {
        "name": "dashboard-service",
        "servers": [{ "host": "dashboard-service", "port": 20022 }]
      },

      {
        "name": "navigation-frontend",
        "servers": [{ "host": "navigation-frontend", "port": 20015 }]
      },
      {
        "name": "navigation-service",
        "servers": [{ "host": "navigation-service", "port": 20012 }]
      },

      {
        "name": "organisation-proxy-public",
        "servers": [{ "host": "organisation-proxy-public", "port": 20030 }]
      },

      {
        "name": "document-proxy-public",
        "servers": [{ "host": "document-proxy-public", "port": 20050 }]
      }
    ]
  }
}
