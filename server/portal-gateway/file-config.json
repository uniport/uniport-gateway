{
  "http": {
    "routers": [
      {
        "name": "root-redirect",
        "rule": "PathPrefix('/')",
        "middlewares": ["root-redirectRegex"]
      },

      {
        "name": "auth",
        "rule": "PathPrefix('/auth')",
        "service": "portal-iam"
      },

      {
        "name": "navigation-frontend",
        "rule": "PathPrefix('/navigation/')",
        "middlewares": ["navigation-authBearer", "navigation-replacePathRegex"],
        "service": "navigation-frontend"
      },
      {
        "name": "navigation-service",
        "rule": "PathPrefix('/navigation/service')",
        "middlewares": ["navigation-authBearer", "navigation-replacePathRegex"],
        "service": "navigation-service"
      },

      {
        "name": "dashboard-redirect",
        "rule": "PathPrefix('/dashboard')",
        "middlewares": ["dashboard-redirectRegex"]
      },
      {
        "name": "dashboard-login-redirect",
        "rule": "PathPrefix('/dashboard/login')",
        "middlewares": ["dashboard-oauth2"]
      },
      {
        "name": "dashboard-frontend",
        "rule": "PathPrefix('/dashboard/')",
        "middlewares": ["dashboard-authBearer", "dashboard-replacePathRegex"],
        "service": "dashboard-frontend"
      },
      {
        "name": "dashboard-service",
        "rule": "PathPrefix('/dashboard/service')",
        "middlewares": ["dashboard-authBearer", "dashboard-replacePathRegex"],
        "service": "dashboard-service"
      },

      {
        "name": "organisation-redirect",
        "rule": "PathPrefix('/organisation')",
        "middlewares": ["organisation-redirectRegex"]
      },
      {
        "name": "organisation",
        "rule": "PathPrefix('/organisation/')",
        "middlewares": [
          "organisation-oauth2",
          "organisation-authBearer",
          "organisation-replacePathRegex"
        ],
        "service": "organisation-service"
      },

      {
        "name": "document-redirect",
        "rule": "PathPrefix('/document')",
        "middlewares": ["document-redirectRegex"]
      },
      {
        "name": "document",
        "rule": "PathPrefix('/document/')",
        "middlewares": [
          "document-oauth2",
          "document-authBearer",
          "document-replacePathRegex"
        ],
        "service": "document-service"
      }
    ],

    "middlewares": [
      {
        "name": "navigation-replacePathRegex",
        "type": "replacePathRegex",
        "options": {
          "regex": "^/navigation/",
          "replacement": "/"
        }
      },
      {
        "name": "dashboard-replacePathRegex",
        "type": "replacePathRegex",
        "options": {
          "regex": "^/dashboard/",
          "replacement": "/"
        }
      },
      {
        "name": "organisation-replacePathRegex",
        "type": "replacePathRegex",
        "options": {
          "regex": "^/organisation/",
          "replacement": "/"
        }
      },
      {
        "name": "document-replacePathRegex",
        "type": "replacePathRegex",
        "options": {
          "regex": "^/document/",
          "replacement": "/"
        }
      },

      {
        "name": "root-redirectRegex",
        "type": "redirectRegex",
        "options": {
          "regex": "^/$",
          "replacement": "/dashboard/"
        }
      },
      {
        "name": "dashboard-redirectRegex",
        "type": "redirectRegex",
        "options": {
          "regex": "^(/dashboard)$",
          "replacement": "$1/"
        }
      },
      {
        "name": "organiation-redirectRegex",
        "type": "redirectRegex",
        "options": {
          "regex": "^/organiation/",
          "replacement": "$1/"
        }
      },
      {
        "name": "document-redirectRegex",
        "type": "redirectRegex",
        "options": {
          "regex": "^/document/",
          "replacement": "$1/"
        }
      },

      {
        "name": "navigation-authBearer",
        "type": "authorizationBearer",
        "options": {
          "sessionScope": "id"
        }
      },
      {
        "name": "dashboard-authBearer",
        "type": "authorizationBearer",
        "options": {
          "sessionScope": "dashboard"
        }
      },
      {
        "name": "organisation-authBearer",
        "type": "authorizationBearer",
        "options": {
          "sessionScope": "organisation"
        }
      },
      {
        "name": "document-authBearer",
        "type": "authorizationBearer",
        "options": {
          "sessionScope": "document"
        }
      },

      {
        "name": "dashboard-oauth2",
        "type": "oauth2",
        "options": {
          "clientId": "Dashboard",
          "clientSecret": "Dashboard!",
          "discoveryUrl": "http://${portal-iam.host}:8080/auth/realms/portal",
          "sessionScope": "dashboard"
        }
      },
      {
        "name": "organisation-oauth2",
        "type": "oauth2",
        "options": {
          "clientId": "Organisation",
          "clientSecret": "Organisation!",
          "discoveryUrl": "http://${portal-iam.host}:8080/auth/realms/portal",
          "sessionScope": "organisation"
        }
      },
      {
        "name": "document-oauth2",
        "type": "oauth2",
        "options": {
          "clientId": "Document",
          "clientSecret": "Document!",
          "discoveryUrl": "http://${portal-iam.host}:8080/auth/realms/portal",
          "sessionScope": "document"
        }
      }
    ],

    "services": [
      {
        "name": "portal-iam",
        "servers": [
          {
            "host": "${portal-iam.host}",
            "port": 8080
          }
        ]
      },

      {
        "name": "navigation-frontend",
        "servers": [
          {
            "host": "${navigation-frontend.host}",
            "port": 20015
          }
        ]
      },
      {
        "name": "navigation-service",
        "servers": [
          {
            "host": "${navigation-service.host}",
            "port": 20012
          }
        ]
      },

      {
        "name": "dashboard-frontend",
        "servers": [
          {
            "host": "${dashboard-frontend.host}",
            "port": 20025
          }
        ]
      },
      {
        "name": "dashboard-service",
        "servers": [
          {
            "host": "${dashboard-service.host}",
            "port": 20022
          }
        ]
      },

      {
        "name": "organisation-service",
        "servers": [
          {
            "host": "${organisation-service.host}",
            "port": 20030
          }
        ]
      },
      {
        "name": "document-service",
        "servers": [
          {
            "host": "${document-service.host}",
            "port": 20050
          }
        ]
      }
    ]
  }
}
