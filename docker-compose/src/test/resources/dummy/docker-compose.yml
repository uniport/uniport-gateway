version: "3"

services:
  dashboard:
    image: traefik/whoami
    labels:
      - "portal.http.routers.dashboard.rule=PathPrefix('/dashboard')"
      - "portal.http.routers.dashboard.middlewares=dashboardRedirectregex, dashboardAuthBearer, dashboardReplacePath"
      - "portal.http.middlewares.dashboardRedirectregex.redirectRegex.regex=^(/dashboard)$$"
      - "portal.http.middlewares.dashboardRedirectregex.redirectRegex.replacement=$$1/"
      - "portal.http.middlewares.dashboardAuthBearer.authorizationBearer.sessionScope=documentScope"
      - "portal.http.middlewares.dashboardReplacePath.replacePathRegex.regex=dashboard"
      - "portal.http.middlewares.dashboardReplacePath.replacePathRegex.replacement=blabla"
  navigation:
    image: traefik/whoami
    labels:
      - "portal.http.routers.navigation.rule=PathPrefix('/navigation')"
      - "portal.http.routers.navigation.middlewares=navigationRedirectregex,  navigationAuthBearer, navigationReplacePath"
      - "portal.http.middlewares.navigationRedirectregex.redirectRegex.regex=^(/navigation)$$"
      - "portal.http.middlewares.navigationRedirectregex.redirectRegex.replacement=$$1/"
      - "portal.http.middlewares.navigationAuthBearer.authorizationBearer.sessionScope=id"
      - "portal.http.middlewares.navigationReplacePath.replacePathRegex.regex=navigation"
      - "portal.http.middlewares.navigationReplacePath.replacePathRegex.replacement=walrus"
  organisation:
    image: traefik/whoami
    labels:
      - "portal.http.routers.organisation.rule=PathPrefix('/organisation')"
      - "portal.http.routers.organisation.middlewares=organisationRedirectregex, organisationOauth2, organisationAuthBearer, organisationReplacePath"
      - "portal.http.middlewares.organisationRedirectregex.redirectRegex.regex=^(/organisation)$$"
      - "portal.http.middlewares.organisationRedirectregex.redirectRegex.replacement=$$1/"
      - "portal.http.middlewares.organisationOauth2.oauth2.clientId=Organisation"
      - "portal.http.middlewares.organisationOauth2.oauth2.clientSecret=Organisation!"
      - "portal.http.middlewares.organisationOauth2.oauth2.discoveryUrl=http://localhost:29000/auth/realms/portal"
      - "portal.http.middlewares.organisationOauth2.oauth2.sessionScope=organisationScope"
      - "portal.http.middlewares.organisationAuthBearer.authorizationBearer.sessionScope=organisationScope"
      - "portal.http.middlewares.organisationReplacePath.replacePathRegex.regex=organisation"
      - "portal.http.middlewares.organisationReplacePath.replacePathRegex.replacement=blub"
