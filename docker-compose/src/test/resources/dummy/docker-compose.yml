version: "3"

services:
  whoami:
    image: traefik/whoami
    labels:
      - "portal.http.routers.whoami.rule=PathPrefix('/whoami')"
      - "portal.http.routers.whoami.middlewares=testRedirectregex, testHeader, testReplacePath"
      - "portal.http.middlewares.testReplacePath.replacePathRegex.regex=whoami"
      - "portal.http.middlewares.testReplacePath.replacePathRegex.replacement=blub"
      - "portal.http.middlewares.testHeader.headers.customRequestHeaders.X-Script-Name=test"
      - "portal.http.middlewares.testHeader.headers.customRequestHeaders.X-Custom-Request-Header=requestHeader"
      - "portal.http.middlewares.testHeader.headers.customResponseHeaders.X-Custom-Response-Header=responseHeader"
      - "portal.http.middlewares.testRedirectregex.redirectRegex.regex=^(/whoami)$$"
      - "portal.http.middlewares.testRedirectregex.redirectRegex.replacement=$$1/"
      - "portal.http.middlewares.testAuthBearer.authorizationBearer.sessionScope=testScope"
  httpbin:
    image: kennethreitz/httpbin
    labels:
      - "portal.http.routers.httpbin.rule=PathPrefix('/httpbin')"
      # no service specified or defined and yet one gets automatically created
      # and assigned to router httpbin.
