{
    "http": {
        "routers": [
            {
                "name": "auth",
                "rule": "PathPrefix('/auth')",
                "service": "iam"
            },
            {
                "name": "root",
                "middlewares": [
                    "rootRedirectregex"
                ],
                "rule": "Path('/')",
                "service": "whoami1"
            },
            {
                "name": "whoami1",
                "rule": "PathPrefix('/whoami1')",
                "middlewares": [],
                "service": "whoami1"
            },
            {
                "name": "whoami2",
                "rule": "PathPrefix('/whoami2')",
                "priority": 50,
                "middlewares": [
                    "whoami2BearerOnly"
                ],
                "service": "whoami2"
            }
        ],
        "middlewares": [
            {
                "name": "rootRedirectregex",
                "type": "redirectRegex",
                "options": {
                    "regex": "^/$",
                    "replacement": "/whoami1"
                }
            },
            {
                "name": "whoami2BearerOnly",
                "type": "bearerOnly",
                "options": {
                    "publicKeys": [
                        {
                            "publicKey": "http://keycloak:8080/auth/realms/testrealm"
                        }
                    ],
                    "audience": [
                        "testclient"
                    ],
                    "issuer": "http://localhost:20000/auth/realms/testrealm",
                    "optional": "false",
                    "claims": [
                        {
                            "claimPath": "$['resource_access']['whoami2']['roles']",
                            "operator": "CONTAINS",
                            "value": [
                                "ADMIN"
                            ]
                        }
                    ],
                    "publicKeysReconciliation": {
                        "enabled": true,
                        "intervalMs": 3600000
                    }
                }
            }
        ],
        "services": [
            {
                "name": "whoami1",
                "verbose": true,
                "servers": [
                    {
                        "host": "whoami1",
                        "port": 80
                    }
                ]
            },
            {
                "name": "whoami2",
                "verbose": true,
                "servers": [
                    {
                        "host": "whoami2",
                        "port": 80
                    }
                ]
            },
            {
                "name": "iam",
                "servers": [
                    {
                        "host": "keycloak",
                        "port": "8080"
                    }
                ]
            }
        ]
    }
}
