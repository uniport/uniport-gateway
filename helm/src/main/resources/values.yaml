replicaCount: 1

initContainers:
    - name: init-portal-iam
      image: busybox:1.33
      command:
          - "sh"
          - "-c"
          - "while ! nc -z portal-iam 8080; do true; done"
    - name: init-navigation-frontend
      image: busybox:1.33
      command:
          - "sh"
          - "-c"
          - "while ! nc -z navigation-frontend 20015; do true; done"
    - name: init-navigation-service
      image: busybox:1.33
      command:
          - "sh"
          - "-c"
          - "while ! nc -z navigation-service 20012; do true; done"
    - name: init-dashboard-frontend
      image: busybox:1.33
      command:
          - "sh"
          - "-c"
          - "while ! nc -z dashboard-frontend 20025; do true; done"
    - name: init-dashboard-service
      image: busybox:1.33
      command:
          - "sh"
          - "-c"
          - "while ! nc -z dashboard-service 20022; do true; done"
    - name: init-document-proxy
      image: busybox:1.33
      command:
          - "sh"
          - "-c"
          - "while ! nc -z document-proxy 20050; do true; done"
    - name: init-organisation-proxy
      image: busybox:1.33
      command:
          - "sh"
          - "-c"
          - "while ! nc -z organisation-proxy 20030; do true; done"

image:
    registry: ${docker.pull.registry}
    baseName: ${project.groupId}
    name: portal-gateway
    tag: ${project.version}
    pullPolicy: IfNotPresent

nameOverride: ""

securityContext:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000

service:
    type: ClusterIP

ports:
    - name: http
      port: 20000

ingress:
    enabled: true
    host: portal
    port: 20000
    className: ""
    annotations:
        {}
        # kubernetes.io/ingress.class: nginx
        # kubernetes.io/tls-acme: "true"

resources: {}

storages: []

env:
    # HTTP protocol for external access
    - name: "PORTAL_GATEWAY_PUBLIC_PROTOCOL"
      value: "http"
    # HTTP host name for external access
    - name: "PORTAL_GATEWAY_PUBLIC_HOSTNAME"
      value: "${deploymentDomain}"
    # HTTP port for external access, must be the same as the exposed port
    - name: "PORTAL_GATEWAY_PUBLIC_PORT"
      value: "80" # TODO

    # IAM
    - name: "portal-iam.host"
      value: "portal-iam"
    - name: "portal-iam.port"
      value: "8080"
    # Navigation
    - name: "navigation-frontend.host"
      value: "navigation-frontend"
    - name: "navigation-frontend.port"
      value: "20015"
    - name: "navigation-service.host"
      value: "navigation-service"
    - name: "navigation-service.port"
      value: "20012"
    # Dashboard
    - name: "dashboard-frontend.host"
      value: "dashboard-frontend"
    - name: "dashboard-frontend.port"
      value: "20025"
    - name: "dashboard-service.host"
      value: "dashboard-service"
    - name: "dashboard-service.port"
      value: "20022"
    # Organisation
    - name: "organisation-service.host"
      value: "organisation-proxy"
    - name: "organisation-service.port"
      value: "20030"
    # Document
    - name: "document-service.host"
      value: "document-proxy"
    - name: "document-service.port"
      value: "20050"
